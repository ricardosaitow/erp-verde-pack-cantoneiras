| ?column?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| CREATE TABLE categorias (
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    nome character varying(100) NOT NULL,
    tipo character varying(20) NOT NULL,
    ativo boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| CREATE TABLE clientes (
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    tipo_pessoa character varying(10),
    razao_social character varying(200) NOT NULL,
    nome_fantasia character varying(200),
    cnpj_cpf character varying(18),
    email character varying(100),
    telefone character varying(20),
    celular character varying(20),
    endereco_completo text,
    cep character varying(10),
    cidade character varying(100),
    estado character varying(2),
    contato_principal character varying(100),
    condicoes_pagamento text,
    limite_credito numeric(15,2),
    observacoes text,
    ativo boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    inscricao_estadual character varying(20)
);
                                                                                                                                                                                                                                                                                                                                                       |
| CREATE TABLE clientes_contatos (
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    cliente_id uuid NOT NULL,
    tipo_contato character varying(20) NOT NULL,
    nome_responsavel character varying(100) NOT NULL,
    email character varying(100),
    telefone character varying(20),
    observacoes text,
    ativo boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| CREATE TABLE compras (
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    numero_compra character varying(50) NOT NULL,
    fornecedor_id uuid NOT NULL,
    data_compra timestamp with time zone NOT NULL DEFAULT now(),
    data_entrega_prevista timestamp with time zone,
    data_entrega_real timestamp with time zone,
    tipo_compra character varying(20) NOT NULL,
    status character varying(20) NOT NULL DEFAULT 'pendente'::character varying,
    valor_total numeric(10,2) NOT NULL DEFAULT 0,
    desconto numeric(10,2) DEFAULT 0,
    frete numeric(10,2) DEFAULT 0,
    outras_despesas numeric(10,2) DEFAULT 0,
    valor_final numeric(10,2) NOT NULL DEFAULT 0,
    condicao_pagamento text,
    numero_nfe character varying(50),
    chave_nfe character varying(44),
    observacoes text,
    created_at timestamp with time zone NOT NULL DEFAULT now(),
    updated_at timestamp with time zone NOT NULL DEFAULT now()
);
                                                                                                                                                                                                                            |
| CREATE TABLE fornecedores (
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    razao_social character varying(200) NOT NULL,
    nome_fantasia character varying(200),
    email character varying(100),
    telefone character varying(20),
    celular character varying(20),
    endereco_completo text,
    cep character varying(10),
    cidade character varying(100),
    estado character varying(2),
    condicoes_pagamento text,
    observacoes text,
    ativo boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    tipo_pessoa character varying(10) NOT NULL DEFAULT 'juridica'::character varying,
    cnpj_cpf character varying(18),
    inscricao_estadual character varying(20),
    contato_principal character varying(100),
    prazo_entrega character varying(50)
);
                                                                                                                                                                                                                                                                                             |
| CREATE TABLE itens_compra (
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    compra_id uuid NOT NULL,
    materia_prima_id uuid,
    produto_revenda_id uuid,
    quantidade numeric(10,3) NOT NULL,
    unidade_medida character varying(20) NOT NULL,
    preco_unitario numeric(10,2) NOT NULL,
    subtotal numeric(10,2) NOT NULL,
    quantidade_recebida numeric(10,3) DEFAULT 0,
    observacoes text,
    created_at timestamp with time zone NOT NULL DEFAULT now(),
    updated_at timestamp with time zone NOT NULL DEFAULT now()
);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| CREATE TABLE materias_primas (
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    nome character varying(200) NOT NULL,
    tipo character varying(50) NOT NULL,
    gramatura numeric(10,2),
    largura_mm numeric(10,2),
    peso_por_metro_g numeric(10,2) DEFAULT 
CASE
    WHEN ((gramatura IS NOT NULL) AND (largura_mm IS NOT NULL)) THEN ((gramatura * largura_mm) / (1000)::numeric)
    ELSE NULL::numeric
END,
    unidade_estoque character varying(20) NOT NULL DEFAULT 'kg'::character varying,
    estoque_atual numeric(15,3) DEFAULT 0,
    estoque_minimo numeric(15,3) DEFAULT 0,
    estoque_ponto_reposicao numeric(15,3) DEFAULT 0,
    custo_por_unidade numeric(15,2) NOT NULL,
    fornecedor_id uuid,
    local_armazenamento character varying(100),
    ativo boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);
                                                                                                                                                                                                                                              |
| CREATE TABLE movimentacoes_estoque (
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    tipo character varying(20) NOT NULL,
    tipo_item character varying(20) NOT NULL,
    item_id uuid NOT NULL,
    quantidade_anterior numeric(15,3) NOT NULL,
    quantidade_movimentada numeric(15,3) NOT NULL,
    quantidade_atual numeric(15,3) NOT NULL,
    unidade character varying(20) NOT NULL,
    motivo character varying(50) NOT NULL,
    documento_referencia text,
    observacoes text,
    usuario_id uuid,
    created_at timestamp without time zone DEFAULT now()
);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| CREATE TABLE ordens_producao (
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    numero_op character varying(50) NOT NULL,
    pedido_id uuid NOT NULL,
    pedido_item_id uuid NOT NULL,
    produto_id uuid NOT NULL,
    quantidade_produzir_metros numeric(15,2) NOT NULL,
    data_programada date,
    data_inicio_producao timestamp without time zone,
    data_conclusao timestamp without time zone,
    status character varying(20) DEFAULT 'aguardando'::character varying,
    instrucoes_tecnicas text,
    observacoes text,
    responsavel_producao character varying(100),
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now(),
    quantidade_pecas integer,
    comprimento_cada_mm numeric(15,2),
    quantidade_simples numeric(15,3)
);
                                                                                                                                                                                                                                                                                                                                                     |
| CREATE TABLE pedidos (
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    numero_pedido character varying(50) NOT NULL,
    cliente_id uuid NOT NULL,
    data_pedido date NOT NULL DEFAULT CURRENT_DATE,
    tipo character varying(20) DEFAULT 'orcamento'::character varying,
    status character varying(20) DEFAULT 'pendente'::character varying,
    valor_produtos numeric(15,2) DEFAULT 0,
    valor_frete numeric(15,2) DEFAULT 0,
    valor_desconto numeric(15,2) DEFAULT 0,
    valor_total numeric(15,2) DEFAULT 0,
    prazo_entrega_dias integer,
    data_entrega_prevista date,
    data_entrega_realizada date,
    forma_pagamento character varying(50),
    condicoes_pagamento text,
    observacoes text,
    observacoes_internas text,
    vendedor_id uuid,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);
                                                                                                                                                                                                                                                                       |
| CREATE TABLE pedidos_itens (
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    pedido_id uuid NOT NULL,
    produto_id uuid NOT NULL,
    tipo_produto character varying(20),
    quantidade_pecas integer,
    comprimento_cada_mm numeric(15,2),
    total_calculado numeric(15,2),
    quantidade_simples numeric(15,3),
    unidade_medida character varying(20) NOT NULL,
    preco_unitario numeric(15,2) NOT NULL,
    subtotal numeric(15,2) NOT NULL,
    observacoes text,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| CREATE TABLE produtos (
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    nome character varying(200) NOT NULL,
    codigo_interno character varying(50),
    descricao text,
    categoria_id uuid,
    tipo character varying(20) NOT NULL,
    altura_mm numeric(10,2),
    largura_mm numeric(10,2),
    espessura_mm numeric(10,2),
    unidade_venda character varying(20) NOT NULL DEFAULT 'metro'::character varying,
    permite_medida_composta boolean DEFAULT false,
    preco_venda_unitario numeric(15,2) NOT NULL,
    margem_lucro_percentual numeric(5,2),
    estoque_atual numeric(15,3),
    estoque_minimo numeric(15,3),
    estoque_ponto_reposicao numeric(15,3),
    custo_compra numeric(15,2),
    fornecedor_id uuid,
    codigo_fornecedor character varying(50),
    lote_minimo_compra numeric(15,3),
    prazo_entrega_dias integer,
    local_armazenamento character varying(100),
    tempo_producao_metros_hora numeric(10,2),
    lead_time_dias integer,
    instrucoes_tecnicas text,
    ativo boolean DEFAULT true,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);
 |
| CREATE TABLE receitas (
    id uuid NOT NULL DEFAULT gen_random_uuid(),
    produto_id uuid NOT NULL,
    materia_prima_id uuid NOT NULL,
    numero_camadas integer NOT NULL DEFAULT 1,
    consumo_por_metro_g numeric(15,3) NOT NULL,
    custo_por_metro numeric(15,2),
    observacoes text,
    created_at timestamp without time zone DEFAULT now(),
    updated_at timestamp without time zone DEFAULT now()
);
                                          | ?column?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 
-- Primary Keys
ALTER TABLE fornecedores ADD CONSTRAINT fornecedores_pkey PRIMARY KEY (id);
ALTER TABLE categorias ADD CONSTRAINT categorias_pkey PRIMARY KEY (id);
ALTER TABLE materias_primas ADD CONSTRAINT materias_primas_pkey PRIMARY KEY (id);
ALTER TABLE produtos ADD CONSTRAINT produtos_pkey PRIMARY KEY (id);
ALTER TABLE receitas ADD CONSTRAINT receitas_pkey PRIMARY KEY (id);
ALTER TABLE pedidos_itens ADD CONSTRAINT pedidos_itens_pkey PRIMARY KEY (id);
ALTER TABLE movimentacoes_estoque ADD CONSTRAINT movimentacoes_estoque_pkey PRIMARY KEY (id);
ALTER TABLE clientes ADD CONSTRAINT clientes_pkey PRIMARY KEY (id);
ALTER TABLE ordens_producao ADD CONSTRAINT ordens_producao_pkey PRIMARY KEY (id);
ALTER TABLE pedidos ADD CONSTRAINT pedidos_pkey PRIMARY KEY (id);
ALTER TABLE compras ADD CONSTRAINT compras_pkey PRIMARY KEY (id);
ALTER TABLE clientes_contatos ADD CONSTRAINT clientes_contatos_pkey PRIMARY KEY (id);
ALTER TABLE itens_compra ADD CONSTRAINT itens_compra_pkey PRIMARY KEY (id); |  


| ?column?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 
-- Foreign Keys
ALTER TABLE materias_primas ADD CONSTRAINT materias_primas_fornecedor_id_fkey FOREIGN KEY (fornecedor_id) REFERENCES fornecedores(id) ON DELETE NO ACTION;
ALTER TABLE produtos ADD CONSTRAINT produtos_categoria_id_fkey FOREIGN KEY (categoria_id) REFERENCES categorias(id) ON DELETE NO ACTION;
ALTER TABLE produtos ADD CONSTRAINT produtos_fornecedor_id_fkey FOREIGN KEY (fornecedor_id) REFERENCES fornecedores(id) ON DELETE NO ACTION;
ALTER TABLE receitas ADD CONSTRAINT receitas_materia_prima_id_fkey FOREIGN KEY (materia_prima_id) REFERENCES materias_primas(id) ON DELETE NO ACTION;
ALTER TABLE receitas ADD CONSTRAINT receitas_produto_id_fkey FOREIGN KEY (produto_id) REFERENCES produtos(id) ON DELETE CASCADE;
ALTER TABLE pedidos_itens ADD CONSTRAINT pedidos_itens_pedido_id_fkey FOREIGN KEY (pedido_id) REFERENCES pedidos(id) ON DELETE CASCADE;
ALTER TABLE pedidos_itens ADD CONSTRAINT pedidos_itens_produto_id_fkey FOREIGN KEY (produto_id) REFERENCES produtos(id) ON DELETE NO ACTION;
ALTER TABLE ordens_producao ADD CONSTRAINT ordens_producao_pedido_id_fkey FOREIGN KEY (pedido_id) REFERENCES pedidos(id) ON DELETE CASCADE;
ALTER TABLE ordens_producao ADD CONSTRAINT ordens_producao_pedido_item_id_fkey FOREIGN KEY (pedido_item_id) REFERENCES pedidos_itens(id) ON DELETE CASCADE;
ALTER TABLE ordens_producao ADD CONSTRAINT ordens_producao_produto_id_fkey FOREIGN KEY (produto_id) REFERENCES produtos(id) ON DELETE RESTRICT;
ALTER TABLE pedidos ADD CONSTRAINT pedidos_cliente_id_fkey FOREIGN KEY (cliente_id) REFERENCES clientes(id) ON DELETE NO ACTION;
ALTER TABLE compras ADD CONSTRAINT compras_fornecedor_id_fkey FOREIGN KEY (fornecedor_id) REFERENCES fornecedores(id) ON DELETE NO ACTION;
ALTER TABLE clientes_contatos ADD CONSTRAINT clientes_contatos_cliente_id_fkey FOREIGN KEY (cliente_id) REFERENCES clientes(id) ON DELETE CASCADE;
ALTER TABLE itens_compra ADD CONSTRAINT itens_compra_compra_id_fkey FOREIGN KEY (compra_id) REFERENCES compras(id) ON DELETE CASCADE;
ALTER TABLE itens_compra ADD CONSTRAINT itens_compra_materia_prima_id_fkey FOREIGN KEY (materia_prima_id) REFERENCES materias_primas(id) ON DELETE NO ACTION;
ALTER TABLE itens_compra ADD CONSTRAINT itens_compra_produto_revenda_id_fkey FOREIGN KEY (produto_revenda_id) REFERENCES produtos(id) ON DELETE NO ACTION; |


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

| ?column?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 
-- Indexes
CREATE INDEX idx_fornecedores_tipo_pessoa ON public.fornecedores USING btree (tipo_pessoa);
CREATE INDEX idx_fornecedores_cnpj_cpf ON public.fornecedores USING btree (cnpj_cpf);
CREATE INDEX idx_fornecedores_razao_social ON public.fornecedores USING btree (razao_social);
CREATE INDEX idx_fornecedores_cidade ON public.fornecedores USING btree (cidade);
CREATE INDEX idx_fornecedores_estado ON public.fornecedores USING btree (estado);
CREATE INDEX idx_fornecedores_ativo ON public.fornecedores USING btree (ativo);
CREATE INDEX idx_materias_primas_ativo ON public.materias_primas USING btree (ativo);
CREATE INDEX idx_produtos_nome ON public.produtos USING btree (nome);
CREATE INDEX idx_produtos_codigo_interno ON public.produtos USING btree (codigo_interno);
CREATE INDEX idx_produtos_categoria_id ON public.produtos USING btree (categoria_id);
CREATE INDEX idx_produtos_fornecedor_id ON public.produtos USING btree (fornecedor_id);
CREATE INDEX idx_produtos_revenda_estoque ON public.produtos USING btree (tipo, estoque_atual, estoque_minimo) WHERE ((tipo)::text = 'revenda'::text);
CREATE INDEX idx_produtos_tipo ON public.produtos USING btree (tipo);
CREATE INDEX idx_produtos_ativo ON public.produtos USING btree (ativo);
CREATE INDEX idx_receitas_produto ON public.receitas USING btree (produto_id);
CREATE INDEX idx_movimentacoes_tipo ON public.movimentacoes_estoque USING btree (tipo);
CREATE INDEX idx_movimentacoes_tipo_item ON public.movimentacoes_estoque USING btree (tipo_item);
CREATE INDEX idx_movimentacoes_item_id ON public.movimentacoes_estoque USING btree (item_id);
CREATE INDEX idx_movimentacoes_created_at ON public.movimentacoes_estoque USING btree (created_at);
CREATE UNIQUE INDEX ordens_producao_numero_op_key ON public.ordens_producao USING btree (numero_op);
CREATE UNIQUE INDEX pedidos_numero_pedido_key ON public.pedidos USING btree (numero_pedido);
CREATE UNIQUE INDEX compras_numero_compra_key ON public.compras USING btree (numero_compra);
CREATE INDEX idx_compras_fornecedor ON public.compras USING btree (fornecedor_id);
CREATE INDEX idx_compras_data ON public.compras USING btree (data_compra);
CREATE INDEX idx_compras_status ON public.compras USING btree (status);
CREATE INDEX idx_compras_tipo ON public.compras USING btree (tipo_compra);
CREATE INDEX idx_clientes_contatos_cliente_id ON public.clientes_contatos USING btree (cliente_id);
CREATE INDEX idx_clientes_contatos_tipo ON public.clientes_contatos USING btree (tipo_contato);
CREATE INDEX idx_itens_compra_compra_id ON public.itens_compra USING btree (compra_id);
CREATE INDEX idx_itens_compra_materia_prima ON public.itens_compra USING btree (materia_prima_id);
CREATE INDEX idx_itens_compra_produto ON public.itens_compra USING btree (produto_revenda_id); |